// SPDX-License-Identifier: MIT
pragma solidity =0.6.6;

import "forge-std/Script.sol";
import "../lib/uniswap-v2-periphery/contracts/test/WETH9.sol";
import "../lib/uniswap-v2-core/contracts/UniswapV2Factory.sol";
import "../lib/uniswap-v2-core/contracts/UniswapV2Pair.sol";
import "../lib/uniswap-v2-periphery/contracts/UniswapV2Router02.sol";

/**
 * @title DeployUniswapV2
 * @notice Deploys Uniswap V2 infrastructure to Mantle Sepolia
 * @dev Deploys WMNT, Factory, and Router
 */
contract DeployUniswapV2 is Script {
    function run() external {
        uint256 deployerPrivateKey = vm.envUint("PRIVATE_KEY");
        address deployer = vm.addr(deployerPrivateKey);

        console.log("Deployer:", deployer);
        console.log("Balance:", deployer.balance);

        vm.startBroadcast(deployerPrivateKey);

        // 1. Deploy WMNT (using WETH9 contract)
        console.log("\n1. Deploying WMNT...");
        WETH9 wmnt = new WETH9();
        console.log("WMNT deployed at:", address(wmnt));

        // 2. Deploy UniswapV2Factory
        console.log("\n2. Deploying UniswapV2Factory...");
        UniswapV2Factory factory = new UniswapV2Factory(deployer);
        console.log("Factory deployed at:", address(factory));

        // Get INIT_CODE_HASH
        bytes32 initCodeHash = keccak256(abi.encodePacked(type(UniswapV2Pair).creationCode));
        console.log("INIT_CODE_HASH:");
        console.logBytes32(initCodeHash);

        // 3. Deploy UniswapV2Router02
        console.log("\n3. Deploying UniswapV2Router02...");
        UniswapV2Router02 router = new UniswapV2Router02(address(factory), address(wmnt));
        console.log("Router deployed at:", address(router));

        vm.stopBroadcast();

        console.log("\n=== Deployment Summary ===");
        console.log("WMNT:", address(wmnt));
        console.log("Factory:", address(factory));
        console.log("Router:", address(router));
        console.log("INIT_CODE_HASH:");
        console.logBytes32(initCodeHash);
    }
}
